{"name":"Dojo-angular-soat","tagline":"","body":"Dojo AngularJS - Soat\r\n=====================\r\n\r\nAu menu : recherche et référencement de films\r\n---------------------------------------------\r\n\r\n- [Template](#template)\r\n- [Module AngularJS](#module)\r\n- [Contrôleur AngularJS](#controller)\r\n- [$scope : liaison et affichage](#scope)\r\n- [$http : requête vers l’API OMDb](#http)\r\n- [Affichage des erreurs](#errors)\r\n- [Affichage du film](#movie)\r\n- [Affichage de l’affiche du film](#poster)\r\n- [Affichage de la liste de films](#list)\r\n- [Ajout du film dans la liste](#add)\r\n- [Suppression du film de la liste](#remove)\r\n- [Limitation de l’envoi de requêtes](#limitation)\r\n- [$watch : champ de recherche unique](#watch)\r\n\r\nChaque étape correspond à un commit.\r\n\r\nCe projet utilise la version 1.2.26 d’AngularJS ainsi que la version 3.2.0 de Bootstrap et se connecte à l’API OMDb http://www.omdbapi.com/. \r\n\r\nTemplate<a name=\"template\" id=\"template\"></a>\r\n--------\r\n\r\n    index.html\r\n    bootstrap.min.css\r\n\r\nModule AngularJS<a name=\"module\" id=\"module\"></a>\r\n----------------\r\n\r\n    index.html\r\n    bootstrap.min.css\r\n    angular.min.js\r\n    app.js\r\n\r\n### index.html\r\n\r\n#### Chargement des fichiers JS\r\n\r\n    <body>\r\n        ...\r\n        <script type=\"text/javascript\" src=\"angular.min.js\"></script>\r\n        <script type=\"text/javascript\" src=\"app.js\"></script>\r\n    </body>\r\n\r\n#### Déclaration du point d’entrée de l’application AngularJS\r\n\r\n    <body ng-app=\"dojo\">\r\n        ...\r\n    </body>\r\n\r\n### app.js\r\n\r\n    var app = angular.module('dojo',[]);\r\n\r\nContrôleur AngularJS<a name=\"controller\" id=\"controller\"></a>\r\n--------------------\r\n\r\n### index.html\r\n\r\n    <body ng-app=\"dojo\">\r\n        <div class=\"container\">\r\n            <div class=\"header\">\r\n                <h1>Check ton film</h1>\r\n            </div>\r\n            <div class=\"row\" ng-controller=\"MovieController\">\r\n                ...\r\n            </div>\r\n        </div>\r\n    </body>\r\n\r\n### app.js\r\n\r\n    app.controller('MovieController', [function () {\r\n        \r\n    }]);\r\n\r\n$scope : liaison et affichage<a name=\"scope\" id=\"scope\"></a>\r\n-----------------------------\r\n\r\n### index.html\r\n\r\n#### Liaison entre une propriété du contrôleur et un champ du formulaire\r\n\r\n    <div class=\"form-group\">\r\n        <input type=\"text\" placeholder=\"Titre\" class=\"form-control\" ng-model=\"title\"></input>\r\n        <input type=\"text\" placeholder=\"Année\" class=\"form-control\" ng-model=\"year\"></input>\r\n    </div>\r\n    <div class=\"form-group\">\r\n        <input type=\"text\" placeholder=\"ID IMDb\" class=\"form-control\" ng-model=\"id\"></input>\r\n    </div>\r\n\r\n#### Affichage d’une propriété du contrôleur\r\n\r\n    <div class=\"panel-body\">\r\n        <div class=\"row\">\r\n            <label class=\"col-md-3\">champ</label>\r\n            <div class=\"col-md-9\">valeur</div>\r\n        </div>\r\n        <div class=\"row\">\r\n            <label class=\"col-md-3\">Titre</label>\r\n            <div class=\"col-md-9\">{{title}}</div>\r\n        </div>\r\n        <div class=\"row\">\r\n            <label class=\"col-md-3\">Année</label>\r\n            <div class=\"col-md-9\">{{year}}</div>\r\n        </div>\r\n        <div class=\"row\">\r\n            <label class=\"col-md-3\">ID IMDb</label>\r\n            <div class=\"col-md-9\">{{id}}</div>\r\n        </div>\r\n    </div>\r\n\r\n### app.js\r\n\r\n    app.controller('MovieController', ['$scope', function ($scope) {\r\n        $scope.title = \"\";\r\n        $scope.year = \"\";\r\n        $scope.id = \"\";\r\n    }]);\r\n\r\n$http : requête vers l’API OMDb<a name=\"http\" id=\"http\"></a>\r\n-------------------------------\r\n\r\n### app.js\r\n\r\n#### Requête get\r\n\r\n    app.controller('MovieController', ['$scope', '$http', function ($scope, $http) {\r\n        ...\r\n        $http.get('http://www.omdbapi.com/?t=' + $scope.title + '&y=' + $scope.year + '&i=' + $scope.id)\r\n        .success(function(data) {\r\n            console.log(\"success\", data);\r\n        })\r\n        .error(function(data) {\r\n            console.log(\"error\", data);\r\n        });\r\n    }]);\r\n\r\n#### Création d’une fonction qui contient la requête\r\n\r\n    app.controller('MovieController', ['$scope', '$http', function ($scope, $http) {\r\n        ...\r\n        $scope.getMovie = function () {\r\n            $http.get('http://www.omdbapi.com/?t=' + $scope.title + '&y=' + $scope.year + '&i=' + $scope.id)\r\n            .success(function(data) {\r\n                console.log(\"success\", data);\r\n            })\r\n            .error(function(data) {\r\n                console.log(\"error\", data);\r\n            });\r\n        };\r\n    }]);\r\n\r\n#### Variable de stockage de la réponse\r\n\r\n    app.controller('MovieController', ['$scope', '$http', function ($scope, $http) {\r\n        ...\r\n        $scope.response = {};\r\n\r\n        $scope.getMovie = function () {\r\n            $http.get('http://www.omdbapi.com/?t=' + $scope.title + '&y=' + $scope.year + '&i=' + $scope.id)\r\n            .success(function(data) {\r\n                $scope.response = data;\r\n            })\r\n            .error(function(data) {\r\n                $scope.response = data;\r\n            });\r\n        };\r\n    }]);\r\n\r\n### index.html\r\n\r\n#### Appel de la fonction lorsqu’un champ est modifié\r\n\r\n    <div class=\"form-group\">\r\n        <input type=\"text\" placeholder=\"Titre\" class=\"form-control\" ng-model=\"title\" ng-change=\"getMovie()\"></input>\r\n        <input type=\"text\" placeholder=\"Année\" class=\"form-control\" ng-model=\"year\" ng-change=\"getMovie()\"></input>\r\n    </div>\r\n    <div class=\"form-group\">\r\n        <input type=\"text\" placeholder=\"ID IMDb\" class=\"form-control\" ng-model=\"id\" ng-change=\"getMovie()\"></input>\r\n    </div>\r\n\r\n#### Affichage de la réponse\r\n\r\n    <div class=\"panel-body\">\r\n        <div class=\"row\">\r\n            <label class=\"col-md-3\">champ</label>\r\n            <div class=\"col-md-9\">valeur</div>\r\n        </div>\r\n        <div class=\"row\">\r\n            <label class=\"col-md-3\">Réponse</label>\r\n            <div class=\"col-md-9\">{{response}}</div>\r\n        </div>\r\n    </div>\r\n\r\nAffichage des erreurs<a name=\"errors\" id=\"errors\"></a>\r\n---------------------\r\n\r\n### app.js\r\n\r\n#### Erreur dans le callback ‘error’ \r\n\r\n    app.controller('MovieController', ['$scope', '$http', function ($scope, $http) {\r\n        ...\r\n        $scope.response = {};\r\n        $scope.error = \"\";\r\n\r\n        $scope.getMovie = function () {\r\n            $http.get(...)\r\n            .success(function(data) {\r\n                $scope.response = data;\r\n            })\r\n            .error(function(data) {\r\n                $scope.error = \"Une erreur est survenue\";\r\n            });\r\n        };\r\n    }]);\r\n\r\n#### Erreur retournée par l’API \r\n\r\n    app.controller('MovieController', ['$scope', '$http', function ($scope, $http) {\r\n        ...\r\n        $scope.getMovie = function () {\r\n            $http.get(...)\r\n            .success(function(data) {\r\n                if (data.Response == \"False\") {\r\n                    $scope.error = data.Error;\r\n                    $scope.response = {};\r\n                }\r\n                else {\r\n                    $scope.error = \"\";\r\n                    $scope.response = data;\r\n                }\r\n            })\r\n            .error(function(data) {\r\n                $scope.error = \"Une erreur est survenue\";\r\n            });\r\n        };\r\n    }]);\r\n\r\n### index.html\r\n\r\n    <div class=\"alert alert-danger\" role=\"alert\" ng-if=\"error\">{{error}}</div>\r\n\r\nAffichage du film<a name=\"movie\" id=\"movie\"></a>\r\n-----------------\r\n\r\n### app.js\r\n\r\n    app.controller('MovieController', ['$scope', '$http', function ($scope, $http) {\r\n        ...\r\n        $scope.response = null;\r\n        $scope.error = \"\";\r\n        $scope.movieKeys = [];\r\n\r\n        $scope.getMovie = function () {\r\n            $http.get(...)\r\n            .success(function(data) {\r\n                if (data.Response == \"False\") {\r\n                    ...\r\n                    $scope.response = null;\r\n                    $scope.movieKeys = [];\r\n                }\r\n                else {\r\n                    ...\r\n                    $scope.movieKeys = Object.keys(data);\r\n                }\r\n            })\r\n            ...\r\n        };\r\n    }]);\r\n\r\n### index.html\r\n\r\n    <div class=\"panel panel-default\" ng-if=\"response\">\r\n        <div class=\"panel-body\">\r\n            <div class=\"row\" ng-repeat=\"k in movieKeys\">\r\n                <label class=\"col-md-3\">{{k}}</label>\r\n                <div class=\"col-md-9\">{{response[k]}}</div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n### Remarque\r\n\r\nPour afficher les propriétés de l’objet dans leur ordre initial, on récupère leur clé dans un tableau qu’on parcourt ensuite. Si on parcourt un objet directement, les propriétés seront classées (par ordre alphabétique par défaut).\r\n\r\nAffichage de l’affiche du film<a name=\"poster\" id=\"poster\"></a>\r\n------------------------------\r\n\r\n### index.html\r\n\r\n#### Affichage de l’image\r\n\r\n    <div class=\"form-group\" ng-if=\"response && response.Poster != 'N/A'\">\r\n        <img ng-src=\"{{response.Poster}}\" width=\"100%\" class=\"img-square\"/>\r\n    </div>\r\n\r\n#### Propriété non affichée\r\n\r\n    <div class=\"panel-body\">\r\n        <div class=\"row\" ng-repeat=\"k in movieKeys\" ng-if=\"k != 'Poster'\">\r\n            <label class=\"col-md-3\">{{k}}</label>\r\n            <div class=\"col-md-9\">{{response[k]}}</div>\r\n        </div>\r\n    </div>\r\n\r\nAffichage de la liste de films<a name=\"list\" id=\"list\"></a>\r\n------------------------------\r\n\r\n### app.js\r\n\r\n    app.controller('MovieController', ['$scope', '$http', function ($scope, $http) {\r\n        ...\r\n\r\n        $scope.moviesList = {\r\n            \"tt0022913\": {imdbID: \"tt0022913\", Title: \"Freaks\", Year: \"1932\"},\r\n            \"tt0062711\": {imdbID: \"tt0062711\", Title: \"Barbarella\", Year: \"1968\"},\r\n        };\r\n        $scope.moviesListKeys = [\"imdbID\", \"Title\", \"Year\"];\r\n\r\n        $scope.getMovie = function () {\r\n            ...\r\n        };\r\n    }]);\r\n\r\n### index.html\r\n\r\n    <table class=\"table table-striped\">\r\n        <tr>\r\n            <th ng-repeat=\"k in moviesListKeys\">{{k}}</th>\r\n        </tr>\r\n        <tr ng-repeat=\"m in moviesList\">\r\n            <td ng-repeat=\"k in moviesListKeys\">{{m[k]}}</td>\r\n        </tr>\r\n    </table>\r\n\r\nAjout du film dans la liste<a name=\"add\" id=\"add\"></a>\r\n---------------------------\r\n\r\n### app.js\r\n\r\n#### Fonction d’ajout du film\r\n\r\n    app.controller('MovieController', ['$scope', '$http', function ($scope, $http) {\r\n        ...\r\n        $scope.moviesList = {};\r\n        ...\r\n        \r\n        $scope.addMovie = function () {\r\n            if ($scope.response === null) return;\r\n            if ($scope.response.hasOwnProperty(\"imdbID\")) {\r\n                $scope.moviesList[$scope.response.imdbID] = $scope.response;\r\n            }\r\n        };\r\n    }]);\r\n\r\n#### Fonction de vérification de la présence du film dans la liste\r\n\r\n    app.controller('MovieController', ['$scope', '$http', function ($scope, $http) {\r\n        ...\r\n\r\n        $scope.isMovieInList = function () {\r\n            if ($scope.moviesList.hasOwnProperty($scope.response[\"imdbID\"])) {\r\n                return true;    \r\n            }\r\n            else {\r\n                return false;\r\n            }\r\n        };\r\n    }]);\r\n\r\n### index.html\r\n\r\n#### Affichage des boutons uniquement si un film a été trouvé\r\n\r\n    <div ng-if=\"response\">\r\n        <div class=\"form-group\" ng-if=\"response.Poster != 'N/A'\">\r\n            <img ng-src=\"{{response.Poster}}\" width=\"100%\" class=\"img-square\"/>\r\n        </div>\r\n        <div class=\"form-group\">\r\n            <button type=\"button\" class=\"btn btn-success btn-block\">Je prends</button>\r\n            <button type=\"button\" class=\"btn btn-danger btn-block\">Je jette</button>\r\n        </div>\r\n    </div>\r\n\r\n#### Appel de la fonction d’ajout\r\n\r\n    <button type=\"button\" class=\"btn btn-success btn-block\" ng-click=\"addMovie()\">Je prends</button>\r\n\r\n#### Affichage du bouton d’ajout uniquement si le film n’est pas dans la liste\r\n\r\n    <button type=\"button\" class=\"btn btn-success btn-block\" ng-click=\"addMovie()\" ng-if=\"!isMovieInList()\">Je prends</button>\r\n\r\nSuppression du film de la liste<a name=\"remove\" id=\"remove\"></a>\r\n-------------------------------\r\n\r\n### app.js\r\n\r\n    app.controller('MovieController', ['$scope', '$http', function ($scope, $http) {\r\n        ...\r\n        $scope.addMovie = function () {...};\r\n\r\n        $scope.removeMovie = function () {\r\n            if ($scope.response === null) return;\r\n            if ($scope.moviesList.hasOwnProperty($scope.response.imdbID)) {\r\n                delete $scope.moviesList[$scope.response.imdbID];\r\n            }\r\n        };\r\n        ...\r\n    }]);\r\n\r\n### index.html\r\n\r\n#### Appel de la fonction de suppression\r\n\r\n    <button type=\"button\" class=\"btn btn-danger btn-block\" ng-click=\"removeMovie()\">Je jette</button>\r\n\r\n#### Affichage du bouton de suppression uniquement si le film est dans la liste\r\n\r\n    <button type=\"button\" class=\"btn btn-danger btn-block\" ng-click=\"removeMovie()\" ng-if=\"isMovieInList()\">Je jette</button>\r\n\r\nLimitation de l’envoi de requêtes<a name=\"limitation\" id=\"limitation\"></a>\r\n---------------------------------\r\n\r\n### app.js\r\n\r\n#### Requête envoyée uniquement si des informations ont été saisies\r\n\r\n    app.controller('MovieController', ['$scope', '$http', function ($scope, $http) {\r\n        ...\r\n        $scope.getMovie = function () {\r\n            var urlParams = \"\";\r\n            if ($scope.id.length > 0) {\r\n                urlParams = \"i=\" + $scope.id;\r\n            }\r\n            if ($scope.title.length > 0) {\r\n                urlParams = \"t=\" + $scope.title;\r\n            }\r\n            if ($scope.year.length > 0) {\r\n                urlParams += \"&y=\" + $scope.year;\r\n            }\r\n            if (urlParams.length > 0) {\r\n                // envoi de requête\r\n            }\r\n            else {\r\n                $scope.error = \"\";\r\n            }\r\n        };\r\n        ...\r\n    }]);\r\n\r\n#### Envoi des paramètres renseignés uniquement\r\n\r\n    app.controller('MovieController', ['$scope', '$http', function ($scope, $http) {\r\n        ...\r\n        $scope.getMovie = function () {\r\n            ...\r\n            if (urlParams.length > 0) {\r\n                $scope.getAPIResponse(urlParams);\r\n            }\r\n            ...\r\n        };\r\n\r\n        $scope.getAPIResponse = function (urlParams) {\r\n            if (urlParams === undefined) return;\r\n            $http.get('http://www.omdbapi.com/?' + urlParams)\r\n            .success(function (data) {\r\n                if (data.Response == \"False\") {\r\n                    $scope.error = data.Error;\r\n                    $scope.response = null;\r\n                    $scope.movieKeys = [];\r\n                }\r\n                else {\r\n                    $scope.error = \"\";\r\n                    $scope.response = data;\r\n                    $scope.movieKeys = Object.keys(data);\r\n                }\r\n            })\r\n            .error(function (data, status) {\r\n                $scope.error = \"Une erreur est survenue\";\r\n            });\r\n        };\r\n        ...\r\n    }]);\r\n\r\n#### Délai entre la fin de la saisie et le lancement de la requête\r\n\r\n    app.controller('MovieController', ['$scope', '$http', function ($scope, $http) {\r\n        ...\r\n        var requestTimeout = null;\r\n        $scope.getMovie = function () {\r\n            clearTimeout(requestTimeout);\r\n            ...\r\n            if (urlParams.length > 0) {\r\n                requestTimeout = setTimeout(function () {\r\n                    $scope.getAPIResponse(urlParams);\r\n                }, 500);\r\n            }\r\n            ...\r\n        };\r\n        ...\r\n    }]);\r\n\r\n$watch : champ de recherche unique<a name=\"watch\" id=\"watch\"></a>\r\n----------------------------------\r\n\r\n### index.html\r\n\r\n    <input type=\"text\" placeholder=\"ID IMDb, titre, année\" class=\"form-control\" ng-model=\"meltedProperties\"></input>\r\n\r\n### app.js\r\n\r\n    app.controller('MovieController', ['$scope', '$http', function ($scope, $http) {\r\n        $scope.title = \"\";\r\n        $scope.year = \"\";\r\n        $scope.id = \"\";\r\n        $scope.meltedProperties = \"\";\r\n        ...\r\n        $scope.getMovie = function () {...};\r\n        \r\n        $scope.$watch('meltedProperties', function() {\r\n            if ($scope.meltedProperties.length == 0) {\r\n                $scope.title = \"\";\r\n                $scope.year = \"\";\r\n                $scope.id = \"\";\r\n                $scope.error = \"\";\r\n                return;\r\n            }\r\n\r\n            var melted = $scope.meltedProperties;\r\n\r\n            var strRegexIMDbID = \"tt(\\\\d+)\";\r\n            var regexIMDbID = new RegExp(strRegexIMDbID);\r\n            var strRegexYear = \"(19|20)(\\\\d){2}\";\r\n            var regexYear = new RegExp(strRegexYear);\r\n\r\n            var regexIMDbIDWithSeparator = new RegExp(\r\n                \"(^\" + strRegexIMDbID + \"$)\" + \"|\" +\r\n                \"(((\\\\W|\\\\s)+)\" + strRegexIMDbID + \"$)\" + \"|\" +\r\n                \"(^\" + strRegexIMDbID + \"(((\\\\W|\\\\s)+)))\" + \"|\" +\r\n                \"(^\" + strRegexYear + \"((\\\\W|\\\\s)+)\" + strRegexIMDbID + \"((\\\\W|\\\\s)+)(\\\\D+)$)\" + \"|\" +\r\n                \"(^(\\\\D+)((\\\\W|\\\\s)+)\" + strRegexIMDbID + \"((\\\\W|\\\\s)+)\" + strRegexYear + \"$)\");\r\n            var regexYearWithSeparator = new RegExp(\r\n                \"(^\" + strRegexYear + \"((\\\\W|\\\\s)+))\" + \"|\" +\r\n                \"(((\\\\W|\\\\s)+)\" + strRegexYear + \"$)\");\r\n\r\n            if (regexIMDbIDWithSeparator.test(melted)) {\r\n                $scope.id = melted.match(regexIMDbID)[0];\r\n                melted = melted.replace($scope.id, \"\");\r\n                while ((/^(\\W|\\s)+/).test(melted)) {\r\n                    melted = melted.substring(1, melted.length);\r\n                }\r\n                while ((/(\\W|\\s)+$/).test(melted)) {\r\n                    melted = melted.substring(0, melted.length-1);\r\n                }\r\n            }\r\n            else {\r\n                $scope.id = \"\";\r\n            }\r\n\r\n            if (regexYearWithSeparator.test(melted)) {\r\n                var s = melted;\r\n                while (regexYearWithSeparator.test(s)) {\r\n                    $scope.year = s.match(regexYear)[0];\r\n                    s = s.replace($scope.year, \"\");\r\n                }\r\n                melted = melted.replace($scope.year, \"\");\r\n                while ((/^(\\W|\\s)+/).test(melted)) {\r\n                    melted = melted.substring(1, melted.length);\r\n                }\r\n                while ((/(\\W|\\s)+$/).test(melted)) {\r\n                    melted = melted.substring(0, melted.length-1);\r\n                }\r\n            }\r\n            else {\r\n                $scope.year = \"\";\r\n            }\r\n\r\n            if (melted.length > 0) {\r\n                $scope.title = melted;\r\n            }\r\n            else {\r\n                $scope.title = \"\";\r\n            }\r\n\r\n            $scope.getMovie();\r\n        });\r\n        ...\r\n    }]);\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}